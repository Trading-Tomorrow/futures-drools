package rules

dialect "java"

import org.futures.model.Weather;
import org.futures.model.PartialSignal;

import org.futures.explain.ExplainListener
global ExplainListener explain

// â˜€ï¸ Drought or excessive heat â†’ bullish (bad harvest risk)
rule "Bullish - Drought or heatwave"
when
    $w : Weather(condition == "drought" || temperatureDeviation > 2)
then
    String monthLabel = $w.getMonth() > 0 ? String.valueOf($w.getMonth()) : "CURRENT";
    insert(new PartialSignal("weather", "BUY", 0.8, monthLabel));

    // HOW: evidÃªncia observada
    explain.how(String.format(
        "Drought/heatwave in %s (Î”T=%.1fÂ°C, month=%s)",
        $w.getRegion(), $w.getTemperatureDeviation(), monthLabel
    ));

    // WHY: decisÃ£o tomada com justificaÃ§Ã£o
    explain.why("Weather â†’ BUY (crop stress risk, confidence=0.8)");

    System.out.println("â˜€ï¸ Drought/heatwave â†’ bullish (" +
        $w.getRegion() + ", Î”T=" + $w.getTemperatureDeviation() +
        "Â°C, month=" + monthLabel + ")");
end

// â„ï¸ Frost â†’ bullish (crop loss risk)
rule "Bullish - Frost conditions"
when
    $w : Weather(condition == "frost" || temperatureDeviation < -2)
then
    String monthLabel = $w.getMonth() > 0 ? String.valueOf($w.getMonth()) : "CURRENT";
    insert(new PartialSignal("weather", "BUY", 0.9, monthLabel));

    explain.how(String.format(
        "Frost conditions in %s (Î”T=%.1fÂ°C, month=%s)",
        $w.getRegion(), $w.getTemperatureDeviation(), monthLabel
    ));
    explain.why("Weather â†’ BUY (frost damage risk, confidence=0.9)");

    System.out.println("â„ï¸ Frost â†’ bullish (" +
        $w.getRegion() + ", Î”T=" + $w.getTemperatureDeviation() +
        "Â°C, month=" + monthLabel + ")");
end

// ğŸŒ§ï¸ Excess rain â†’ bearish (better yields expected)
rule "Bearish - Excess rain"
when
    $w : Weather(condition == "rain" && precipitationDeviation > 30)
then
    String monthLabel = $w.getMonth() > 0 ? String.valueOf($w.getMonth()) : "CURRENT";
    insert(new PartialSignal("weather", "SELL", 0.7, monthLabel));

    explain.how(String.format(
        "Excess rain in %s (Î”Rain=%.0f%%, month=%s)",
        $w.getRegion(), $w.getPrecipitationDeviation(), monthLabel
    ));
    explain.why("Weather â†’ SELL (better yields expected, confidence=0.7)");

    System.out.println("ğŸŒ§ï¸ Excess rain â†’ bearish (" +
        $w.getRegion() + ", Î”Rain=" + $w.getPrecipitationDeviation() +
        "%, month=" + monthLabel + ")");
end

// ğŸŒ¤ï¸ Ideal conditions â†’ neutral
rule "Neutral - Ideal conditions"
when
    $w : Weather(condition == "ideal")
then
    String monthLabel = $w.getMonth() > 0 ? String.valueOf($w.getMonth()) : "CURRENT";
    insert(new PartialSignal("weather", "HOLD", 0.5, monthLabel));

    explain.how(String.format(
        "Ideal weather in %s (month=%s)",
        $w.getRegion(), monthLabel
    ));
    explain.why("Weather â†’ HOLD (balanced conditions, confidence=0.5)");

    System.out.println("ğŸŒ¤ï¸ Ideal weather â†’ neutral (" +
        $w.getRegion() + ", month=" + monthLabel + ")");
end
