package rules

dialect "java"

import org.futures.model.Weather;
import org.futures.model.PartialSignal;

// ☀️ Drought or excessive heat → bullish (bad harvest risk)
rule "Bullish - Drought or heatwave"
when
    $w : Weather(condition == "drought" || temperatureDeviation > 2)
then
    String monthLabel = $w.getMonth() > 0 ? String.valueOf($w.getMonth()) : "CURRENT";
    insert(new PartialSignal("weather", "BUY", 0.8, monthLabel));
    System.out.println("☀️ Drought/heatwave → bullish ("
        + $w.getRegion() + ", ΔT=" + $w.getTemperatureDeviation()
        + "°C, month=" + monthLabel + ")");
end

// ❄️ Frost → bullish (crop loss risk)
rule "Bullish - Frost conditions"
when
    $w : Weather(condition == "frost" || temperatureDeviation < -2)
then
    String monthLabel = $w.getMonth() > 0 ? String.valueOf($w.getMonth()) : "CURRENT";
    insert(new PartialSignal("weather", "BUY", 0.9, monthLabel));
    System.out.println("❄️ Frost → bullish ("
        + $w.getRegion() + ", ΔT=" + $w.getTemperatureDeviation()
        + "°C, month=" + monthLabel + ")");
end

// 🌧️ Excess rain → bearish (better yields expected)
rule "Bearish - Excess rain"
when
    $w : Weather(condition == "rain" && precipitationDeviation > 30)
then
    String monthLabel = $w.getMonth() > 0 ? String.valueOf($w.getMonth()) : "CURRENT";
    insert(new PartialSignal("weather", "SELL", 0.7, monthLabel));
    System.out.println("🌧️ Excess rain → bearish ("
        + $w.getRegion() + ", ΔRain=" + $w.getPrecipitationDeviation()
        + "%, month=" + monthLabel + ")");
end

// 🌤️ Ideal conditions → neutral
rule "Neutral - Ideal conditions"
when
    $w : Weather(condition == "ideal")
then
    String monthLabel = $w.getMonth() > 0 ? String.valueOf($w.getMonth()) : "CURRENT";
    insert(new PartialSignal("weather", "HOLD", 0.5, monthLabel));
    System.out.println("🌤️ Ideal weather → neutral ("
        + $w.getRegion() + ", month=" + monthLabel + ")");
end
