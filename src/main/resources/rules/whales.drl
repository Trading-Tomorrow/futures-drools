package rules

dialect "java"

import org.futures.model.WhaleActivity;
import org.futures.model.PartialSignal;

// 🟢 Whale accumulation → bullish
rule "Bullish - Whale accumulation detected"
when
    $w : WhaleActivity(
        volume > (volume7dAvg * 2),
        openInterestChange > 5,
        avgTradeSize > 200
    )
then
    String monthLabel = $w.getPeriod() != null && !$w.getPeriod().isEmpty() ? $w.getPeriod() : "CURRENT";
    insert(new PartialSignal("whale", "BUY", 0.9, monthLabel));
    System.out.println("🐋 Whale accumulation → bullish (period=" + $w.getPeriod() +
        ", OIΔ=" + $w.getOpenInterestChange() + "%, avgTrade=" + $w.getAvgTradeSize() + ")");
end

// 🔴 Whale distribution → bearish
rule "Bearish - Whale distribution detected"
when
    $w : WhaleActivity(
        volume > (volume7dAvg * 2),
        openInterestChange < -5,
        avgTradeSize > 200
    )
then
    String monthLabel = $w.getPeriod() != null && !$w.getPeriod().isEmpty() ? $w.getPeriod() : "CURRENT";
    insert(new PartialSignal("whale", "SELL", 0.9, monthLabel));
    System.out.println("🐋 Whale distribution → bearish (period=" + $w.getPeriod() +
        ", OIΔ=" + $w.getOpenInterestChange() + "%, avgTrade=" + $w.getAvgTradeSize() + ")");
end

// ⚪ Neutral / no clear whale signal
rule "Neutral - Normal volume and OI"
when
    $w : WhaleActivity(
        volume <= (volume7dAvg * 2),
        openInterestChange >= -5 && openInterestChange <= 5
    )
then
    String monthLabel = $w.getPeriod() != null && !$w.getPeriod().isEmpty() ? $w.getPeriod() : "CURRENT";
    insert(new PartialSignal("whale", "HOLD", 0.5, monthLabel));
    System.out.println("⚪ No whale anomaly detected → neutral (period=" + $w.getPeriod() + ")");
end
