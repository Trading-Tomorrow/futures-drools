package rules

dialect "java"

import org.futures.model.WhaleActivity;
import org.futures.model.PartialSignal;

// ğŸŸ¢ Whale accumulation â†’ bullish
rule "Bullish - Whale accumulation detected"
when
    $w : WhaleActivity(
        volume > (volume7dAvg * 2),
        openInterestChange > 5,
        avgTradeSize > 200
    )
then
    String monthLabel = $w.getPeriod() != null && !$w.getPeriod().isEmpty() ? $w.getPeriod() : "CURRENT";
    insert(new PartialSignal("whale", "BUY", 0.9, monthLabel));
    System.out.println("ğŸ‹ Whale accumulation â†’ bullish (period=" + $w.getPeriod() +
        ", OIÎ”=" + $w.getOpenInterestChange() + "%, avgTrade=" + $w.getAvgTradeSize() + ")");
end

// ğŸ”´ Whale distribution â†’ bearish
rule "Bearish - Whale distribution detected"
when
    $w : WhaleActivity(
        volume > (volume7dAvg * 2),
        openInterestChange < -5,
        avgTradeSize > 200
    )
then
    String monthLabel = $w.getPeriod() != null && !$w.getPeriod().isEmpty() ? $w.getPeriod() : "CURRENT";
    insert(new PartialSignal("whale", "SELL", 0.9, monthLabel));
    System.out.println("ğŸ‹ Whale distribution â†’ bearish (period=" + $w.getPeriod() +
        ", OIÎ”=" + $w.getOpenInterestChange() + "%, avgTrade=" + $w.getAvgTradeSize() + ")");
end

// âšª Neutral / no clear whale signal
rule "Neutral - Normal volume and OI"
when
    $w : WhaleActivity(
        volume <= (volume7dAvg * 2),
        openInterestChange >= -5 && openInterestChange <= 5
    )
then
    String monthLabel = $w.getPeriod() != null && !$w.getPeriod().isEmpty() ? $w.getPeriod() : "CURRENT";
    insert(new PartialSignal("whale", "HOLD", 0.5, monthLabel));
    System.out.println("âšª No whale anomaly detected â†’ neutral (period=" + $w.getPeriod() + ")");
end
